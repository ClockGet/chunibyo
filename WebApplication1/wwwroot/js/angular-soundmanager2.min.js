/** @license
 *
 * SoundManager 2: JavaScript Sound for the Web
 * ----------------------------------------------
 * http://schillmania.com/projects/soundmanager2/
 *
 * Copyright (c) 2007, Scott Schiller. All rights reserved.
 * Code provided under the BSD License:
 * http://schillmania.com/projects/soundmanager2/license.txt
 *
 * V2.97a.20140901
 */
(function(n,t){"use strict";function r(i,r){function ir(n){return u.preferFlash&&ft&&!u.ignoreFlash&&u.flash[n]!==t&&u.flash[n]}function y(n){return function(t){var i=this._s,r;return i&&i._a?r=n.call(this,t):(i&&i.id?u._wD(i.id+": Ignoring "+t.type):u._wD(af+"Ignoring "+t.type),r=null),r}}this.setupOptions={url:i||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"};this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100};this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null};this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null};this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}};this.movieID="sm2-container";this.id=r||"sm2movie";this.debugID="soundmanager-debug";this.debugURLParam=/([#?&])debug=1/i;this.versionNumber="V2.97a.20140901";this.version=null;this.movieURL=null;this.altURL=null;this.swfLoaded=!1;this.enabled=!1;this.oMC=null;this.sounds={};this.soundIDs=[];this.muted=!1;this.didFlashBlock=!1;this.filePattern=null;this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i};this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1};this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null};this.html5={usingFlash:null};this.flash={};this.html5Only=!1;this.ignoreFlash=!1;var eu,u=this,ou=null,f=null,s="soundManager",l=s+": ",af="HTML5::",it,w=navigator.userAgent,kt=n.location.href.toString(),e=document,rr,su,ur,o,ut=[],fr=!0,tt,dt=!1,gt=!1,v=!1,d=!1,hi=!1,h,vf=0,ni,b,er,hu,or,lt,yt,pt,cu,sr,hr,cr,ot,ci,lr,at,ar,ti,li,ai,wt,lu,vr,au=["log","info","warn","error"],vu=8,yu,yr,pu,ii=null,pr=null,c,wr,bt,nt,wu,vi,yi,st,a,ri=!1,br=!1,bu,ku,du,pi=0,ui=null,wi,vt=[],fi,g=null,gu,bi,ei,ht,ki,kr,nf,p,tf=Array.prototype.slice,rt=!1,dr,ft,gr,rf,et,uf,nu,di,ff=0,gi=w.match(/(ipad|iphone|ipod)/i),ef=w.match(/android/i),ct=w.match(/msie/i),yf=w.match(/webkit/i),nr=w.match(/safari/i)&&!w.match(/chrome/i),tu=w.match(/opera/i),iu=w.match(/(mobile|pre\/|xoom)/i)||gi||ef,ru=!kt.match(/usehtml5audio/i)&&!kt.match(/sm2\-ignorebadua/i)&&nr&&!w.match(/silk/i)&&w.match(/OS X 10_6_([3-7])/i),oi=n.console!==t&&console.log!==t,uu=e.hasFocus!==t?e.hasFocus():null,tr=nr&&(e.hasFocus===t||!e.hasFocus()),of=!tr,sf=/(mp3|mp4|mpa|m4a|m4b)/i,k=1e3,fu="about:blank",pf="data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==",si=e.location?e.location.protocol.match(/http/i):null,hf=si?"":"http://",cf=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,lf=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],wf=new RegExp("\\.("+lf.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i;this.useAltURL=!si;nt={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"};this.hasHTML5=function(){try{return Audio!==t&&(tu&&opera!==t&&opera.version()<10?new Audio(null):new Audio).canPlayType!==t}catch(n){return!1}}();this.setup=function(n){var i=!u.url;return n!==t&&v&&g&&u.ok()&&(n.flashVersion!==t||n.url!==t||n.html5Test!==t)&&st(c("setupLate")),er(n),n&&(i&&ti&&n.url!==t&&u.beginDelayedInit(),ti||n.url===t||e.readyState!=="complete"||setTimeout(at,1)),u};this.ok=function(){return g?v&&!d:u.useHTML5Audio&&u.hasHTML5};this.supported=this.ok;this.getMovie=function(t){return it(t)||e[t]||n[t]};this.createSound=function(n,i){function y(){return r=vi(r),u.sounds[r.id]=new eu(r),u.soundIDs.push(r.id),u.sounds[r.id]}var l,p,r,e=null;if(l=s+".createSound(): ",p=l+c(v?"notOK":"notReady"),!v||!u.ok())return st(p),!1;if(i!==t&&(n={id:n,url:i}),r=b(n),r.url=wi(r.url),r.id===undefined&&(r.id=u.setupOptions.idPrefix+ff++),r.id.toString().charAt(0).match(/^[0-9]$/)&&u._wD(l+c("badID",r.id),2),u._wD(l+r.id+(r.url?" ("+r.url+")":""),1),a(r.id,!0))return u._wD(l+r.id+" exists",1),u.sounds[r.id];if(bi(r))e=y(),u._wD(r.id+": Using HTML5"),e._setup_html5(r);else{if(u.html5Only)return u._wD(r.id+": No HTML5 support for this sound, and no Flash. Exiting."),y();if(u.html5.usingFlash&&r.url&&r.url.match(/data\:/i))return u._wD(r.id+": data: URIs not supported via Flash. Exiting."),y();o>8&&(r.isMovieStar===null&&(r.isMovieStar=!!(r.serverURL||(r.type?r.type.match(cf):!1)||r.url&&r.url.match(wf))),r.isMovieStar&&(u._wD(l+"using MovieStar handling"),r.loops>1&&h("noNSLoop")));r=yi(r,l);e=y();o===8?f._createSound(r.id,r.loops||1,r.usePolicyFile):(f._createSound(r.id,r.url,r.usePeakData,r.useWaveformData,r.useEQData,r.isMovieStar,r.isMovieStar?r.bufferTime:!1,r.loops||1,r.serverURL,r.duration||null,r.autoPlay,!0,r.autoLoad,r.usePolicyFile),r.serverURL||(e.connected=!0,r.onconnect&&r.onconnect.apply(e)));!r.serverURL&&(r.autoLoad||r.autoPlay)&&e.load(r)}return!r.serverURL&&r.autoPlay&&e.play(),e};this.destroySound=function(n,t){if(!a(n))return!1;var i=u.sounds[n],r;for(i._iO={},i.stop(),i.unload(),r=0;r<u.soundIDs.length;r++)if(u.soundIDs[r]===n){u.soundIDs.splice(r,1);break}return t||i.destruct(!0),i=null,delete u.sounds[n],!0};this.load=function(n,t){return a(n)?u.sounds[n].load(t):!1};this.unload=function(n){return a(n)?u.sounds[n].unload():!1};this.onPosition=function(n,t,i,r){return a(n)?u.sounds[n].onposition(t,i,r):!1};this.onposition=this.onPosition;this.clearOnPosition=function(n,t,i){return a(n)?u.sounds[n].clearOnPosition(t,i):!1};this.play=function(n,t){var i=null,r=t&&!(t instanceof Object);if(!v||!u.ok())return st(s+".play(): "+c(v?"notOK":"notReady")),!1;if(a(n,r))r&&(t={url:t});else{if(!r)return!1;r&&(t={url:t});t&&t.url&&(u._wD(s+'.play(): Attempting to create "'+n+'"',1),t.id=n,i=u.createSound(t).play())}return i===null&&(i=u.sounds[n].play(t)),i};this.start=this.play;this.setPosition=function(n,t){return a(n)?u.sounds[n].setPosition(t):!1};this.stop=function(n){return a(n)?(u._wD(s+".stop("+n+")",1),u.sounds[n].stop()):!1};this.stopAll=function(){var n;u._wD(s+".stopAll()",1);for(n in u.sounds)u.sounds.hasOwnProperty(n)&&u.sounds[n].stop()};this.pause=function(n){return a(n)?u.sounds[n].pause():!1};this.pauseAll=function(){for(var n=u.soundIDs.length-1;n>=0;n--)u.sounds[u.soundIDs[n]].pause()};this.resume=function(n){return a(n)?u.sounds[n].resume():!1};this.resumeAll=function(){for(var n=u.soundIDs.length-1;n>=0;n--)u.sounds[u.soundIDs[n]].resume()};this.togglePause=function(n){return a(n)?u.sounds[n].togglePause():!1};this.setPan=function(n,t){return a(n)?u.sounds[n].setPan(t):!1};this.setVolume=function(n,t){return a(n)?u.sounds[n].setVolume(t):!1};this.mute=function(n){var t=0;if(n instanceof String&&(n=null),n)return a(n)?(u._wD(s+'.mute(): Muting "'+n+'"'),u.sounds[n].mute()):!1;for(u._wD(s+".mute(): Muting all sounds"),t=u.soundIDs.length-1;t>=0;t--)u.sounds[u.soundIDs[t]].mute();return u.muted=!0,!0};this.muteAll=function(){u.mute()};this.unmute=function(n){var t;if(n instanceof String&&(n=null),n)return a(n)?(u._wD(s+'.unmute(): Unmuting "'+n+'"'),u.sounds[n].unmute()):!1;for(u._wD(s+".unmute(): Unmuting all sounds"),t=u.soundIDs.length-1;t>=0;t--)u.sounds[u.soundIDs[t]].unmute();return u.muted=!1,!0};this.unmuteAll=function(){u.unmute()};this.toggleMute=function(n){return a(n)?u.sounds[n].toggleMute():!1};this.getMemoryUse=function(){var n=0;return f&&o!==8&&(n=parseInt(f._getMemoryUse(),10)),n};this.disable=function(i){var r;if(i===t&&(i=!1),d)return!1;for(d=!0,h("shutdown",1),r=u.soundIDs.length-1;r>=0;r--)yu(u.sounds[u.soundIDs[r]]);return ni(i),p.remove(n,"load",yt),!0};this.canPlayMIME=function(n){var t;return u.hasHTML5&&(t=ei({type:n})),!t&&g&&(t=n&&u.ok()?!!((o>8?n.match(cf):null)||n.match(u.mimePattern)):null),t};this.canPlayURL=function(n){var t;return u.hasHTML5&&(t=ei({url:n})),!t&&g&&(t=n&&u.ok()?!!n.match(u.filePattern):null),t};this.canPlayLink=function(n){return n.type!==t&&n.type&&u.canPlayMIME(n.type)?!0:u.canPlayURL(n.href)};this.getSoundById=function(n,t){if(!n)return null;var i=u.sounds[n];return i||t||u._wD(s+'.getSoundById(): Sound "'+n+'" not found.',2),i};this.onready=function(t,i){var r="onready",f=!1;if(typeof t=="function")v&&u._wD(c("queue",r)),i||(i=n),or(r,t,i),lt(),f=!0;else throw c("needFunction",r);return f};this.ontimeout=function(t,i){var r="ontimeout",f=!1;if(typeof t=="function")v&&u._wD(c("queue",r)),i||(i=n),or(r,t,i),lt({type:r}),f=!0;else throw c("needFunction",r);return f};this._writeDebug=function(n,i){var f,r;return u.debugMode?oi&&u.useConsole&&(i&&typeof i=="object"?console.log(n,i):au[i]!==t?console[au[i]](n):console.log(n),u.consoleOnly)?!0:(f=it("soundmanager-debug"),!f)?!1:(r=e.createElement("div"),++vf%2==0&&(r.className="sm2-alt"),i=i===t?0:parseInt(i,10),r.appendChild(e.createTextNode(n)),i&&(i>=2&&(r.style.fontWeight="bold"),i===3&&(r.style.color="#ff3333")),f.insertBefore(r,f.firstChild),f=null,!0):!1};kt.indexOf("sm2-debug=alert")!==-1&&(this._writeDebug=function(t){n.alert(t)});this._wD=this._writeDebug;this._debug=function(){var n,t;for(h("currentObj",1),n=0,t=u.soundIDs.length;n<t;n++)u.sounds[u.soundIDs[n]]._debug()};this.reboot=function(t,i){u.soundIDs.length&&u._wD("Destroying "+u.soundIDs.length+" SMSound object"+(u.soundIDs.length!==1?"s":"")+"...");for(var e,o,r=u.soundIDs.length-1;r>=0;r--)u.sounds[u.soundIDs[r]].destruct();if(f)try{ct&&(pr=f.innerHTML);ii=f.parentNode.removeChild(f)}catch(c){h("badRemove",2)}if(pr=ii=g=f=null,u.enabled=ti=v=ri=br=dt=gt=d=rt=u.swfLoaded=!1,u.soundIDs=[],u.sounds={},ff=0,t)ut=[];else for(r in ut)if(ut.hasOwnProperty(r))for(e=0,o=ut[r].length;e<o;e++)ut[r][e].fired=!1;return i||u._wD(s+": Rebooting..."),u.html5={usingFlash:null},u.flash={},u.html5Only=!1,u.ignoreFlash=!1,n.setTimeout(function(){lr();i||u.beginDelayedInit()},20),u};this.reset=function(){return h("reset"),u.reboot(!0,!0)};this.getMoviePercent=function(){return f&&"PercentLoaded"in f?f.PercentLoaded():null};this.beginDelayedInit=function(){hi=!0;at();setTimeout(function(){return br?!1:(ai(),ci(),br=!0,!0)},20);pt()};this.destruct=function(){u._wD(s+".destruct()");u.disable(!0)};eu=function(n){var i=this,y,it,ut,s,w,ft,d=!1,r=[],l=0,g,ot,e=null,v,nt;v={duration:null,time:null};this.id=n.id;this.sID=this.id;this.url=n.url;this.options=b(n);this.instanceOptions=this.options;this._iO=this.instanceOptions;this.pan=this.options.pan;this.volume=this.options.volume;this.isHTML5=!1;this._a=null;nt=this.url?!1:!0;this.id3={};this._debug=function(){u._wD(i.id+": Merged options:",i.options)};this.load=function(n){var s=null,r;if(n!==t?i._iO=b(n,i.options):(n=i.options,i._iO=n,e&&e!==i.url&&(h("manURL"),i._iO.url=i.url,i.url=null)),i._iO.url||(i._iO.url=i.url),i._iO.url=wi(i._iO.url),i.instanceOptions=i._iO,r=i._iO,u._wD(i.id+": load ("+r.url+")"),!r.url&&!i.url)return u._wD(i.id+": load(): url is unassigned. Exiting.",2),i;if(i.isHTML5||o!==8||i.url||r.autoPlay||u._wD(i.id+": Flash 8 load() limitation: Wait for onload() before calling play().",1),r.url===i.url&&i.readyState!==0&&i.readyState!==2)return h("onURL",1),i.readyState===3&&r.onload&&di(i,function(){r.onload.apply(i,[!!i.duration])}),i;if(i.loaded=!1,i.readyState=1,i.playState=0,i.id3={},bi(r))s=i._setup_html5(r),s._called_load?u._wD(i.id+": Ignoring request to load again"):(i._html5_canplay=!1,i.url!==r.url&&(u._wD(h("manURL")+": "+r.url),i._a.src=r.url,i.setPosition(0)),i._a.autobuffer="auto",i._a.preload="auto",i._a._called_load=!0);else{if(u.html5Only)return u._wD(i.id+": No flash support. Exiting."),i;if(i._iO.url&&i._iO.url.match(/data\:/i))return u._wD(i.id+": data: URIs not supported via Flash. Exiting."),i;try{i.isHTML5=!1;i._iO=yi(vi(r));i._iO.autoPlay&&(i._iO.position||i._iO.from)&&(u._wD(i.id+": Disabling autoPlay because of non-zero offset case"),i._iO.autoPlay=!1);r=i._iO;o===8?f._load(i.id,r.url,r.stream,r.autoPlay,r.usePolicyFile):f._load(i.id,r.url,!!r.stream,!!r.autoPlay,r.loops||1,!!r.autoLoad,r.usePolicyFile)}catch(c){h("smError",2);tt("onload",!1);wt({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return i.url=r.url,i};this.unload=function(){return i.readyState!==0&&(u._wD(i.id+": unload()"),i.isHTML5?(s(),i._a&&(i._a.pause(),e=ki(i._a))):o===8?f._unload(i.id,fu):f._unload(i.id),y()),i};this.destruct=function(n){u._wD(i.id+": Destruct");i.isHTML5?(s(),i._a&&(i._a.pause(),ki(i._a),rt||ut(),i._a._s=null,i._a=null)):(i._iO.onfailure=null,f._destroySound(i.id));n||u.destroySound(i.id,!0)};this.play=function(n,r){var e,v,y,c,s,l,a,g=!0,h=null;if(e=i.id+": play(): ",r=r===t?!0:r,n||(n={}),i.url&&(i._iO.url=i.url),i._iO=b(i._iO,i.options),i._iO=b(n,i._iO),i._iO.url=wi(i._iO.url),i.instanceOptions=i._iO,!i.isHTML5&&i._iO.serverURL&&!i.connected)return i.getAutoPlay()||(u._wD(e+" Netstream not connected yet - setting autoPlay"),i.setAutoPlay(!0)),i;if((bi(i._iO)&&(i._setup_html5(i._iO),w()),i.playState!==1||i.paused||(v=i._iO.multiShot,v?u._wD(e+"Already playing (multi-shot)",1):(u._wD(e+"Already playing (one-shot)",1),i.isHTML5&&i.setPosition(i._iO.position),h=i)),h!==null)||(n.url&&n.url!==i.url&&(i.readyState||i.isHTML5||o!==8||!nt?i.load(i._iO):nt=!1),i.loaded?u._wD(e.substr(0,e.lastIndexOf(":"))):i.readyState===0?(u._wD(e+"Attempting to load"),i.isHTML5||u.html5Only?i.isHTML5?i.load(i._iO):(u._wD(e+"Unsupported type. Exiting."),h=i):(i._iO.autoPlay=!0,i.load(i._iO)),i.instanceOptions=i._iO):i.readyState===2?(u._wD(e+"Could not load - exiting",2),h=i):u._wD(e+"Loading - attempting to play..."),h!==null))return h;if(!i.isHTML5&&o===9&&i.position>0&&i.position===i.duration&&(u._wD(e+"Sound at end, resetting to position:0"),n.position=0),i.paused&&i.position>=0&&(!i._iO.serverURL||i.position>0))u._wD(e+"Resuming from paused state",1),i.resume();else{if(i._iO=b(n,i._iO),(!i.isHTML5&&i._iO.position!==null&&i._iO.position>0||i._iO.from!==null&&i._iO.from>0||i._iO.to!==null)&&i.instanceCount===0&&i.playState===0&&!i._iO.serverURL){if(c=function(){i._iO=b(n,i._iO);i.play(i._iO)},i.isHTML5&&!i._html5_canplay?(u._wD(e+"Beginning load for non-zero offset case"),i.load({_oncanplay:c}),h=!1):i.isHTML5||i.loaded||i.readyState&&i.readyState===2||(u._wD(e+"Preloading for non-zero offset case"),i.load({onload:c}),h=!1),h!==null)return h;i._iO=ot()}(!i.instanceCount||i._iO.multiShotEvents||i.isHTML5&&i._iO.multiShot&&!rt||!i.isHTML5&&o>8&&!i.getAutoPlay())&&i.instanceCount++;i._iO.onposition&&i.playState===0&&ft(i);i.playState=1;i.paused=!1;i.position=i._iO.position!==t&&!isNaN(i._iO.position)?i._iO.position:0;i.isHTML5||(i._iO=yi(vi(i._iO)));i._iO.onplay&&r&&(i._iO.onplay.apply(i),d=!0);i.setVolume(i._iO.volume,!0);i.setPan(i._iO.pan,!0);i.isHTML5?i.instanceCount<2?(w(),y=i._setup_html5(),i.setPosition(i._iO.position),y.play()):(u._wD(i.id+": Cloning Audio() for instance #"+i.instanceCount+"..."),s=new Audio(i._iO.url),l=function(){p.remove(s,"ended",l);i._onfinish(i);ki(s);s=null},a=function(){p.remove(s,"canplay",a);try{s.currentTime=i._iO.position/k}catch(n){st(i.id+": multiShot play() failed to apply position of "+i._iO.position/k)}s.play()},p.add(s,"ended",l),i._iO.volume!==undefined&&(s.volume=Math.max(0,Math.min(1,i._iO.volume/100))),i.muted&&(s.muted=!0),i._iO.position?p.add(s,"canplay",a):s.play()):(g=f._start(i.id,i._iO.loops||1,o===9?i.position:i.position/k,i._iO.multiShot||!1),o!==9||g||(u._wD(e+"No sound hardware, or 32-sound ceiling hit",2),i._iO.onplayerror&&i._iO.onplayerror.apply(i)))}return i};this.start=this.play;this.stop=function(n){var t=i._iO,r;return i.playState===1&&(u._wD(i.id+": stop()"),i._onbufferchange(0),i._resetOnPosition(0),i.paused=!1,i.isHTML5||(i.playState=0),g(),t.to&&i.clearOnPosition(t.to),i.isHTML5?i._a&&(r=i.position,i.setPosition(0),i.position=r,i._a.pause(),i.playState=0,i._onTimer(),s()):(f._stop(i.id,n),t.serverURL&&i.unload()),i.instanceCount=0,i._iO={},t.onstop&&t.onstop.apply(i)),i};this.setAutoPlay=function(n){u._wD(i.id+": Autoplay turned "+(n?"on":"off"));i._iO.autoPlay=n;i.isHTML5||(f._setAutoPlay(i.id,n),n&&(i.instanceCount||i.readyState!==1||(i.instanceCount++,u._wD(i.id+": Incremented instance count to "+i.instanceCount))))};this.getAutoPlay=function(){return i._iO.autoPlay};this.setPosition=function(n){n===t&&(n=0);var e,r,s=i.isHTML5?Math.max(n,0):Math.min(i.duration||i._iO.duration,Math.max(n,0));if(i.position=s,r=i.position/k,i._resetOnPosition(i.position),i._iO.position=s,i.isHTML5){if(i._a){if(i._html5_canplay){if(i._a.currentTime!==r){u._wD(i.id+": setPosition("+r+")");try{i._a.currentTime=r;(i.playState===0||i.paused)&&i._a.pause()}catch(h){u._wD(i.id+": setPosition("+r+") failed: "+h.message,2)}}}else if(r)return u._wD(i.id+": setPosition("+r+"): Cannot seek yet, sound not ready",2),i;i.paused&&i._onTimer(!0)}}else e=o===9?i.position:r,i.readyState&&i.readyState!==2&&f._setPosition(i.id,e,i.paused||!i.playState,i._iO.multiShot);return i};this.pause=function(n){return i.paused||i.playState===0&&i.readyState!==1?i:(u._wD(i.id+": pause()"),i.paused=!0,i.isHTML5?(i._setup_html5().pause(),s()):(n||n===t)&&f._pause(i.id,i._iO.multiShot),i._iO.onpause&&i._iO.onpause.apply(i),i)};this.resume=function(){var n=i._iO;return i.paused?(u._wD(i.id+": resume()"),i.paused=!1,i.playState=1,i.isHTML5?(i._setup_html5().play(),w()):(n.isMovieStar&&!n.serverURL&&i.setPosition(i.position),f._pause(i.id,n.multiShot)),!d&&n.onplay?(n.onplay.apply(i),d=!0):n.onresume&&n.onresume.apply(i),i):i};this.togglePause=function(){return(u._wD(i.id+": togglePause()"),i.playState===0)?(i.play({position:o===9&&!i.isHTML5?i.position:i.position/k}),i):(i.paused?i.resume():i.pause(),i)};this.setPan=function(n,r){return n===t&&(n=0),r===t&&(r=!1),i.isHTML5||f._setPan(i.id,n),i._iO.pan=n,r||(i.pan=n,i.options.pan=n),i};this.setVolume=function(n,r){return n===t&&(n=100),r===t&&(r=!1),i.isHTML5?i._a&&(u.muted&&!i.muted&&(i.muted=!0,i._a.muted=!0),i._a.volume=Math.max(0,Math.min(1,n/100))):f._setVolume(i.id,u.muted&&!i.muted||i.muted?0:n),i._iO.volume=n,r||(i.volume=n,i.options.volume=n),i};this.mute=function(){return i.muted=!0,i.isHTML5?i._a&&(i._a.muted=!0):f._setVolume(i.id,0),i};this.unmute=function(){i.muted=!1;var n=i._iO.volume!==t;return i.isHTML5?i._a&&(i._a.muted=!1):f._setVolume(i.id,n?i._iO.volume:i.options.volume),i};this.toggleMute=function(){return i.muted?i.unmute():i.mute()};this.onPosition=function(n,u,f){return r.push({position:parseInt(n,10),method:u,scope:f!==t?f:i,fired:!1}),i};this.onposition=this.onPosition;this.clearOnPosition=function(n,t){var i;if(n=parseInt(n,10),isNaN(n))return!1;for(i=0;i<r.length;i++)n===r[i].position&&(t&&t!==r[i].method||(r[i].fired&&l--,r.splice(i,1)))};this._processOnPosition=function(){var t,n,u=r.length;if(!u||!i.playState||l>=u)return!1;for(t=u-1;t>=0;t--)n=r[t],!n.fired&&i.position>=n.position&&(n.fired=!0,l++,n.method.apply(n.scope,[n.position]),u=r.length);return!0};this._resetOnPosition=function(n){var t,i,u=r.length;if(!u)return!1;for(t=u-1;t>=0;t--)i=r[t],i.fired&&n<=i.position&&(i.fired=!1,l--);return!0};ot=function(){var n=i._iO,r=n.from,t=n.to,e,f;return f=function(){u._wD(i.id+': "To" time of '+t+" reached.");i.clearOnPosition(t,f);i.stop()},e=function(){if(u._wD(i.id+': Playing "from" '+r),t!==null&&!isNaN(t))i.onPosition(t,f)},r===null||isNaN(r)||(n.position=r,n.multiShot=!1,e()),n};ft=function(){var n,t=i._iO.onposition;if(t)for(n in t)if(t.hasOwnProperty(n))i.onPosition(parseInt(n,10),t[n])};g=function(){var n,t=i._iO.onposition;if(t)for(n in t)t.hasOwnProperty(n)&&i.clearOnPosition(parseInt(n,10))};w=function(){i.isHTML5&&bu(i)};s=function(){i.isHTML5&&ku(i)};y=function(n){n||(r=[],l=0);d=!1;i._hasTimer=null;i._a=null;i._html5_canplay=!1;i.bytesLoaded=null;i.bytesTotal=null;i.duration=i._iO&&i._iO.duration?i._iO.duration:null;i.durationEstimate=null;i.buffered=[];i.eqData=[];i.eqData.left=[];i.eqData.right=[];i.failures=0;i.isBuffering=!1;i.instanceOptions={};i.instanceCount=0;i.loaded=!1;i.metadata={};i.readyState=0;i.muted=!1;i.paused=!1;i.peakData={left:0,right:0};i.waveformData={left:[],right:[]};i.playState=0;i.position=null;i.id3={}};y();this._onTimer=function(n){var t,r=!1,u,f={};if(i._hasTimer||n)return i._a&&(n||(i.playState>0||i.readyState===1)&&!i.paused)&&(t=i._get_html5_duration(),t!==v.duration&&(v.duration=t,i.duration=t,r=!0),i.durationEstimate=i.duration,u=i._a.currentTime*k||0,u!==v.time&&(v.time=u,r=!0),(r||n)&&i._whileplaying(u,f,f,f,f)),r};this._get_html5_duration=function(){var t=i._iO,n=i._a&&i._a.duration?i._a.duration*k:t&&t.duration?t.duration:null;return n&&!isNaN(n)&&n!==Infinity?n:null};this._apply_loop=function(n,t){!n.loop&&t>1&&u._wD("Note: Native HTML5 looping is infinite.",1);n.loop=t>1?"loop":""};this._setup_html5=function(n){var r=b(i._iO,n),t=rt?ou:i._a,f=decodeURI(r.url),u;if(rt?f===decodeURI(dr)&&(u=!0):f===decodeURI(e)&&(u=!0),t){if(t._s)if(rt)t._s&&t._s.playState&&!u&&t._s.stop();else if(!rt&&f===decodeURI(e))return i._apply_loop(t,r.loops),t;u||(e&&y(!1),t.src=r.url,i.url=r.url,e=r.url,dr=r.url,t._called_load=!1)}else r.autoLoad||r.autoPlay?(i._a=new Audio(r.url),i._a.load()):i._a=tu&&opera.version()<10?new Audio(null):new Audio,t=i._a,t._called_load=!1,rt&&(ou=t);return i.isHTML5=!0,i._a=t,t._s=i,it(),i._apply_loop(t,r.loops),r.autoLoad||r.autoPlay?i.load():(t.autobuffer=!1,t.preload="auto"),t};it=function(){function t(n,t,r){return i._a?i._a.addEventListener(n,t,r||!1):null}if(i._a._added_events)return!1;var n;i._a._added_events=!0;for(n in et)et.hasOwnProperty(n)&&t(n,et[n]);return!0};ut=function(){function t(n,t,r){return i._a?i._a.removeEventListener(n,t,r||!1):null}var n;u._wD(i.id+": Removing event listeners");i._a._added_events=!1;for(n in et)et.hasOwnProperty(n)&&t(n,et[n])};this._onload=function(n){var r,t=!!n||!i.isHTML5&&o===8&&i.duration;return r=i.id+": ",u._wD(r+(t?"onload()":"Failed to load / invalid sound?"+(i.duration?" -":" Zero-length duration reported.")+" ("+i.url+")"),t?1:2),t||i.isHTML5||(u.sandbox.noRemote===!0&&u._wD(r+c("noNet"),1),u.sandbox.noLocal===!0&&u._wD(r+c("noLocal"),1)),i.loaded=t,i.readyState=t?3:2,i._onbufferchange(0),i._iO.onload&&di(i,function(){i._iO.onload.apply(i,[t])}),!0};this._onbufferchange=function(n){return i.playState===0?!1:n&&i.isBuffering||!n&&!i.isBuffering?!1:(i.isBuffering=n===1,i._iO.onbufferchange&&(u._wD(i.id+": Buffer state change: "+n),i._iO.onbufferchange.apply(i,[n])),!0)};this._onsuspend=function(){return i._iO.onsuspend&&(u._wD(i.id+": Playback suspended"),i._iO.onsuspend.apply(i)),!0};this._onfailure=function(n,t,r){if(i.failures++,u._wD(i.id+": Failure ("+i.failures+"): "+n),i._iO.onfailure&&i.failures===1)i._iO.onfailure(n,t,r);else u._wD(i.id+": Ignoring failure")};this._onwarning=function(n,t,r){if(i._iO.onwarning)i._iO.onwarning(n,t,r)};this._onfinish=function(){var n=i._iO.onfinish;i._onbufferchange(0);i._resetOnPosition(0);i.instanceCount&&(i.instanceCount--,i.instanceCount||(g(),i.playState=0,i.paused=!1,i.instanceCount=0,i.instanceOptions={},i._iO={},s(),i.isHTML5&&(i.position=0)),(!i.instanceCount||i._iO.multiShotEvents)&&n&&(u._wD(i.id+": onfinish()"),di(i,function(){n.apply(i)})))};this._whileloading=function(n,t,r,u){var f=i._iO;i.bytesLoaded=n;i.bytesTotal=t;i.duration=Math.floor(r);i.bufferLength=u;i.durationEstimate=i.isHTML5||f.isMovieStar?i.duration:f.duration?i.duration>f.duration?i.duration:f.duration:parseInt(i.bytesTotal/i.bytesLoaded*i.duration,10);i.isHTML5||(i.buffered=[{start:0,end:i.duration}]);(i.readyState!==3||i.isHTML5)&&f.whileloading&&f.whileloading.apply(i)};this._whileplaying=function(n,r,u,f,e){var s=i._iO,h;return isNaN(n)||n===null?!1:(i.position=Math.max(0,n),i._processOnPosition(),!i.isHTML5&&o>8&&(s.usePeakData&&r!==t&&r&&(i.peakData={left:r.leftPeak,right:r.rightPeak}),s.useWaveformData&&u!==t&&u&&(i.waveformData={left:u.split(","),right:f.split(",")}),s.useEQData&&e!==t&&e&&e.leftEQ&&(h=e.leftEQ.split(","),i.eqData=h,i.eqData.left=h,e.rightEQ!==t&&e.rightEQ&&(i.eqData.right=e.rightEQ.split(",")))),i.playState===1&&(i.isHTML5||o!==8||i.position||!i.isBuffering||i._onbufferchange(0),s.whileplaying&&s.whileplaying.apply(i)),!0)};this._oncaptiondata=function(n){u._wD(i.id+": Caption data received.");i.captiondata=n;i._iO.oncaptiondata&&i._iO.oncaptiondata.apply(i,[n])};this._onmetadata=function(n,t){u._wD(i.id+": Metadata received.");for(var f={},r=0,e=n.length;r<e;r++)f[n[r]]=t[r];i.metadata=f;console.log("updated metadata",i.metadata);i._iO.onmetadata&&i._iO.onmetadata.call(i,i.metadata)};this._onid3=function(n,t){u._wD(i.id+": ID3 data received.");for(var f=[],r=0,e=n.length;r<e;r++)f[n[r]]=t[r];i.id3=b(i.id3,f);i._iO.onid3&&i._iO.onid3.apply(i)};this._onconnect=function(n){n=n===1;u._wD(i.id+": "+(n?"Connected.":"Failed to connect? - "+i.url),n?1:2);i.connected=n;n&&(i.failures=0,a(i.id)&&(i.getAutoPlay()?i.play(t,i.getAutoPlay()):i._iO.autoLoad&&i.load()),i._iO.onconnect&&i._iO.onconnect.apply(i,[n]))};this._ondataerror=function(n){i.playState>0&&(u._wD(i.id+": Data error: "+n),i._iO.ondataerror&&i._iO.ondataerror.apply(i))};this._debug()};li=function(){return e.body||e.getElementsByTagName("div")[0]};it=function(n){return e.getElementById(n)};b=function(n,i){var e=n||{},f,r;f=i===t?u.defaultOptions:i;for(r in f)f.hasOwnProperty(r)&&e[r]===t&&(e[r]=typeof f[r]!="object"||f[r]===null?f[r]:b(e[r],f[r]));return e};di=function(t,i){t.isHTML5||o!==8?i():n.setTimeout(i,0)};hu={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1};er=function(n,i){var r,f=!0,s=i!==t,o=u.setupOptions,e=hu;if(n===t){f=[];for(r in o)o.hasOwnProperty(r)&&f.push(r);for(r in e)e.hasOwnProperty(r)&&(typeof u[r]=="object"?f.push(r+": {...}"):u[r]instanceof Function?f.push(r+": function() {...}"):f.push(r));return u._wD(c("setup",f.join(", "))),!1}for(r in n)if(n.hasOwnProperty(r))if(typeof n[r]!="object"||n[r]===null||n[r]instanceof Array||n[r]instanceof RegExp)s&&e[i]!==t?u[i][r]=n[r]:o[r]!==t?(u.setupOptions[r]=n[r],u[r]=n[r]):e[r]===t?(st(c(u[r]===t?"setupUndef":"setupError",r),2),f=!1):u[r]instanceof Function?u[r].apply(u,n[r]instanceof Array?n[r]:[n[r]]):u[r]=n[r];else if(e[r]===t)st(c(u[r]===t?"setupUndef":"setupError",r),2),f=!1;else return er(n[r],r);return f};p=function(){function i(n){var i=tf.call(n),r=i.length;return t?(i[1]="on"+i[1],r>3&&i.pop()):r===3&&i.push(!1),i}function r(n,i){var r=n.shift(),f=[u[i]];t?r[f](n[0],n[1]):r[f].apply(r,n)}function f(){r(i(arguments),"add")}function e(){r(i(arguments),"remove")}var t=n.attachEvent,u={add:t?"attachEvent":"addEventListener",remove:t?"detachEvent":"removeEventListener"};return{add:f,remove:e}}();et={abort:y(function(){u._wD(this._s.id+": abort")}),canplay:y(function(){var n=this._s,i;if(n._html5_canplay)return!0;if(n._html5_canplay=!0,u._wD(n.id+": canplay"),n._onbufferchange(0),i=n._iO.position!==t&&!isNaN(n._iO.position)?n._iO.position/k:null,this.currentTime!==i){u._wD(n.id+": canplay: Setting position to "+i);try{this.currentTime=i}catch(r){u._wD(n.id+": canplay: Setting position of "+i+" failed: "+r.message,2)}}n._iO._oncanplay&&n._iO._oncanplay()}),canplaythrough:y(function(){var n=this._s;n.loaded||(n._onbufferchange(0),n._whileloading(n.bytesLoaded,n.bytesTotal,n._get_html5_duration()),n._onload(!0))}),durationchange:y(function(){var n=this._s,t;t=n._get_html5_duration();isNaN(t)||t===n.duration||(u._wD(this._s.id+": durationchange ("+t+")"+(n.duration?", previously "+n.duration:"")),n.durationEstimate=n.duration=t)}),ended:y(function(){var n=this._s;u._wD(n.id+": ended");n._onfinish()}),error:y(function(){u._wD(this._s.id+": HTML5 error, code "+this.error.code);this._s._onload(!1)}),loadeddata:y(function(){var n=this._s;u._wD(n.id+": loadeddata");n._loaded||nr||(n.duration=n._get_html5_duration())}),loadedmetadata:y(function(){u._wD(this._s.id+": loadedmetadata")}),loadstart:y(function(){u._wD(this._s.id+": loadstart");this._s._onbufferchange(1)}),play:y(function(){this._s._onbufferchange(0)}),playing:y(function(){u._wD(this._s.id+": playing "+String.fromCharCode(9835));this._s._onbufferchange(0)}),progress:y(function(n){var f=this._s,t,e,o,h=0,c=n.type==="progress",i=n.target.buffered,r=n.loaded||0,s=n.total||1;if(f.buffered=[],i&&i.length){for(t=0,e=i.length;t<e;t++)f.buffered.push({start:i.start(t)*k,end:i.end(t)*k});if(h=(i.end(0)-i.start(0))*k,r=Math.min(1,h/(n.target.duration*k)),c&&i.length>1){for(o=[],e=i.length,t=0;t<e;t++)o.push(n.target.buffered.start(t)*k+"-"+n.target.buffered.end(t)*k);u._wD(this._s.id+": progress, timeRanges: "+o.join(", "))}c&&!isNaN(r)&&u._wD(this._s.id+": progress, "+Math.floor(r*100)+"% loaded")}isNaN(r)||(f._whileloading(r,s,f._get_html5_duration()),r&&s&&r===s&&et.canplaythrough.call(this,n))}),ratechange:y(function(){u._wD(this._s.id+": ratechange")}),suspend:y(function(n){var t=this._s;u._wD(this._s.id+": suspend");et.progress.call(this,n);t._onsuspend()}),stalled:y(function(){u._wD(this._s.id+": stalled")}),timeupdate:y(function(){this._s._onTimer()}),waiting:y(function(){var n=this._s;u._wD(this._s.id+": waiting");n._onbufferchange(1)})};bi=function(n){return n&&(n.type||n.url||n.serverURL)?n.serverURL||n.type&&ir(n.type)?!1:n.type?ei({type:n.type}):ei({url:n.url})||u.html5Only||n.url.match(/data\:/i):!1};ki=function(n){var t;return n&&(t=nr?fu:u.html5.canPlayType("audio/wav")?pf:fu,n.src=t,n._called_unload!==undefined&&(n._called_load=!1)),rt&&(dr=null),t};ei=function(n){if(!u.useHTML5Audio||!u.hasHTML5)return!1;var h=n.url||null,i=n.type||null,o=u.audioFormats,f,s,r,e;if(i&&u.html5[i]!==t)return u.html5[i]&&!ir(i);if(!ht){ht=[];for(e in o)o.hasOwnProperty(e)&&(ht.push(e),o[e].related&&(ht=ht.concat(o[e].related)));ht=new RegExp("\\.("+ht.join("|")+")(\\?.*)?$","i")}return r=h?h.toLowerCase().match(ht):null,r&&r.length?r=r[1]:i?(s=i.indexOf(";"),r=(s!==-1?i.substr(0,s):i).substr(6)):f=!1,r&&u.html5[r]!==t?f=u.html5[r]&&!ir(r):(i="audio/"+r,f=u.html5.canPlayType({type:i}),u.html5[r]=f,f=f&&u.html5[i]&&!ir(i)),f};nf=function(){function s(n){var r,f,t=!1,o=!1;if(!e||typeof e.canPlayType!="function")return t;if(n instanceof Array){for(i=0,f=n.length;i<f;i++)(u.html5[n[i]]||e.canPlayType(n[i]).match(u.html5Test))&&(o=!0,u.html5[n[i]]=!0,u.flash[n[i]]=!!n[i].match(sf));t=o}else r=e&&typeof e.canPlayType=="function"?e.canPlayType(n):!1,t=!!(r&&r.match(u.html5Test));return t}if(!u.useHTML5Audio||!u.hasHTML5)return u.html5.usingFlash=!0,g=!0,!1;var e=Audio!==t?tu&&opera.version()<10?new Audio(null):new Audio:null,n,o,f={},r,i;r=u.audioFormats;for(n in r)if(r.hasOwnProperty(n)&&(o="audio/"+n,f[n]=s(r[n].type),f[o]=f[n],n.match(sf)?(u.flash[n]=!0,u.flash[o]=!0):(u.flash[n]=!1,u.flash[o]=!1),r[n]&&r[n].related))for(i=r[n].related.length-1;i>=0;i--)f["audio/"+r[n].related[i]]=f[n],u.html5[r[n].related[i]]=f[n],u.flash[r[n].related[i]]=f[n];return f.canPlayType=e?s:null,u.html5=b(u.html5,f),u.html5.usingFlash=gu(),g=u.html5.usingFlash,!0};ot={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:s+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:l+"Verify that %s is a valid path.",tryDebug:"Try "+s+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:l+"Non-HTTP page ("+e.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:l+"Special case: Waiting for SWF to load with window focus...",waitForever:l+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:l+"Waiting for 100% SWF load...",needFunction:l+"Function object expected for %s",badID:'Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:l+"_debug(): Current sound objects",waitOnload:l+"Waiting for window.onload()",docLoaded:l+"Document already loaded",onload:l+"initComplete(): calling soundManager.onload()",onloadOK:s+".onload() complete",didInit:l+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:l+"Failed to remove Flash node.",shutdown:s+".disable(): Shutting down",queue:l+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+nt.swfTimedout+" CSS...",fbLoaded:"Flash loaded",fbHandler:l+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:s+".load(): current URL already assigned.",badFV:s+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:l+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:l+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:s+".setup(): allowed parameters: %s",setupError:s+'.setup(): "%s" cannot be assigned with this method.',setupUndef:s+'.setup(): Could not find option "%s"',setupLate:s+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:l+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready. "+String.fromCharCode(10003),reset:s+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device."};c=function(){var n,i,u,r,t;if(n=tf.call(arguments),r=n.shift(),t=ot&&ot[r]?ot[r]:"",t&&n&&n.length)for(i=0,u=n.length;i<u;i++)t=t.replace("%s",n[i]);return t};vi=function(n){return o===8&&n.loops>1&&n.stream&&(h("as2loop"),n.stream=!1),n};yi=function(n,t){return n&&!n.usePolicyFile&&(n.onid3||n.usePeakData||n.useWaveformData||n.useEQData)&&(u._wD((t||"")+c("policy")),n.usePolicyFile=!0),n};st=function(n){oi&&console.warn!==t?console.warn(n):u._wD(n)};rr=function(){return!1};yu=function(n){for(var t in n)n.hasOwnProperty(t)&&typeof n[t]=="function"&&(n[t]=rr);t=null};yr=function(n){n===t&&(n=!1);(d||n)&&u.disable(n)};pu=function(n){var i=null,t;if(n)if(n.match(/\.swf(\?.*)?$/i)){if(i=n.substr(n.toLowerCase().lastIndexOf(".swf?")+4),i)return n}else n.lastIndexOf("/")!==n.length-1&&(n+="/");return t=(n&&n.lastIndexOf("/")!==-1?n.substr(0,n.lastIndexOf("/")+1):"./")+u.movieURL,u.noSWFCache&&(t+="?ts="+(new Date).getTime()),t};hr=function(){o=parseInt(u.flashVersion,10);o!==8&&o!==9&&(u._wD(c("badFV",o,vu)),u.flashVersion=o=vu);var n=u.debugMode||u.debugFlash?"_debug.swf":".swf";u.useHTML5Audio&&!u.html5Only&&u.audioFormats.mp4.required&&o<9&&(u._wD(c("needfl9")),u.flashVersion=o=9);u.version=u.versionNumber+(u.html5Only?" (HTML5-only mode)":o===9?" (AS3/Flash 9)":" (AS2/Flash 8)");o>8?(u.defaultOptions=b(u.defaultOptions,u.flash9Options),u.features.buffering=!0,u.defaultOptions=b(u.defaultOptions,u.movieStarOptions),u.filePatterns.flash9=new RegExp("\\.(mp3|"+lf.join("|")+")(\\?.*)?$","i"),u.features.movieStar=!0):u.features.movieStar=!1;u.filePattern=u.filePatterns[o!==8?"flash9":"flash8"];u.movieURL=(o===8?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",n);u.features.peakData=u.features.waveformData=u.features.eqData=o>8};lu=function(n,t){if(!f)return!1;f._setPolling(n,t)};vr=function(){if(u.debugURLParam.test(kt)&&(u.debugMode=!0),it(u.debugID))return!1;var n,t,i,r,f;if(u.debugMode&&!it(u.debugID)&&(!oi||!u.useConsole||!u.consoleOnly)){n=e.createElement("div");n.id=u.debugID+"-toggle";r={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001};n.appendChild(e.createTextNode("-"));n.onclick=wu;n.title="Toggle SM2 debug console";w.match(/msie 6/i)&&(n.style.position="absolute",n.style.cursor="hand");for(f in r)r.hasOwnProperty(f)&&(n.style[f]=r[f]);if(t=e.createElement("div"),t.id=u.debugID,t.style.display=u.debugMode?"block":"none",u.debugMode&&!it(n.id)){try{i=li();i.appendChild(n)}catch(o){throw new Error(c("domError")+" \n"+o.toString());}i.appendChild(t)}}i=null};a=this.getSoundById;h=function(n,t){return n?u._wD(c(n),t):""};wu=function(){var n=it(u.debugID),t=it(u.debugID+"-toggle");if(!n)return!1;fr?(t.innerHTML="+",n.style.display="none"):(t.innerHTML="-",n.style.display="block");fr=!fr};tt=function(i,r,u){if(n.sm2Debugger!==t)try{sm2Debugger.handleEvent(i,r,u)}catch(f){return!1}return!0};bt=function(){var n=[];return u.debugMode&&n.push(nt.sm2Debug),u.debugFlash&&n.push(nt.flashDebug),u.useHighPerformance&&n.push(nt.highPerf),n.join(" ")};wr=function(){var t=c("fbHandler"),i=u.getMoviePercent(),n=nt,r={type:"FLASHBLOCK"};if(u.html5Only)return!1;u.ok()?(u.didFlashBlock&&u._wD(t+": Unblocked"),u.oMC&&(u.oMC.className=[bt(),n.swfDefault,n.swfLoaded+(u.didFlashBlock?" "+n.swfUnblocked:"")].join(" "))):(g&&(u.oMC.className=bt()+" "+n.swfDefault+" "+(i===null?n.swfTimedout:n.swfError),u._wD(t+": "+c("fbTimeout")+(i?" ("+c("fbLoaded")+")":""))),u.didFlashBlock=!0,lt({type:"ontimeout",ignoreInit:!0,error:r}),wt(r))};or=function(n,i,r){ut[n]===t&&(ut[n]=[]);ut[n].push({method:i,scope:r||null,fired:!1})};lt=function(n){if((n||(n={type:u.ok()?"onready":"ontimeout"}),!v&&n&&!n.ignoreInit)||n.type==="ontimeout"&&(u.ok()||d&&!n.ignoreInit))return!1;var o={success:n&&n.ignoreInit?u.ok():!d},f=n&&n.type?ut[n.type]||[]:[],i=[],t,r,e=[o],s=g&&!u.ok();for(n.error&&(e[0].error=n.error),t=0,r=f.length;t<r;t++)f[t].fired!==!0&&i.push(f[t]);if(i.length)for(t=0,r=i.length;t<r;t++)i[t].scope?i[t].method.apply(i[t].scope,e):i[t].method.apply(this,e),s||(i[t].fired=!0);return!0};yt=function(){n.setTimeout(function(){u.useFlashBlock&&wr();lt();typeof u.onload=="function"&&(h("onload",1),u.onload.apply(n),h("onloadOK",1));u.waitForWindowLoad&&p.add(n,"load",yt)},1)};gr=function(){if(ft!==t)return ft;var r=!1,e=navigator,o=e.plugins,u,f,i,s=n.ActiveXObject;if(o&&o.length)f="application/x-shockwave-flash",i=e.mimeTypes,i&&i[f]&&i[f].enabledPlugin&&i[f].enabledPlugin.description&&(r=!0);else if(s!==t&&!w.match(/MSAppHost/i)){try{u=new s("ShockwaveFlash.ShockwaveFlash")}catch(h){u=null}r=!!u;u=null}return ft=r,r};gu=function(){var i,n,t=u.audioFormats,r=gi&&!!w.match(/os (1|2|3_0|3_1)\s/i);if(r?(u.hasHTML5=!1,u.html5Only=!0,u.oMC&&(u.oMC.style.display="none")):u.useHTML5Audio&&(u.html5&&u.html5.canPlayType||(u._wD("SoundManager: No HTML5 Audio() support detected."),u.hasHTML5=!1),ru&&u._wD(l+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(ft?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1)),u.useHTML5Audio&&u.hasHTML5){fi=!0;for(n in t)t.hasOwnProperty(n)&&t[n].required&&(u.html5.canPlayType(t[n].type)?u.preferFlash&&(u.flash[n]||u.flash[t[n].type])&&(i=!0):(fi=!1,i=!0))}return u.ignoreFlash&&(i=!1,fi=!0),u.html5Only=u.hasHTML5&&u.useHTML5Audio&&!i,!u.html5Only};wi=function(n){var t,f,i=0,r;if(n instanceof Array){for(t=0,f=n.length;t<f;t++)if(n[t]instanceof Object){if(u.canPlayMIME(n[t].type)){i=t;break}}else if(u.canPlayURL(n[t])){i=t;break}n[i].url&&(n[i]=n[i].url);r=n[i]}else r=n;return r};bu=function(n){n._hasTimer||(n._hasTimer=!0,!iu&&u.html5PollingInterval&&(ui===null&&pi===0&&(ui=setInterval(du,u.html5PollingInterval)),pi++))};ku=function(n){n._hasTimer&&(n._hasTimer=!1,!iu&&u.html5PollingInterval&&pi--)};du=function(){var n;if(ui!==null&&!pi)return clearInterval(ui),ui=null,!1;for(n=u.soundIDs.length-1;n>=0;n--)u.sounds[u.soundIDs[n]].isHTML5&&u.sounds[u.soundIDs[n]]._hasTimer&&u.sounds[u.soundIDs[n]]._onTimer()};wt=function(i){i=i!==t?i:{};typeof u.onerror=="function"&&u.onerror.apply(n,[{type:i.type!==t?i.type:null}]);i.fatal!==t&&i.fatal&&u.disable()};rf=function(){if(!ru||!gr())return!1;var t=u.audioFormats,i;for(var n in t)if(t.hasOwnProperty(n)&&(n==="mp3"||n==="mp4")&&(u._wD(s+": Using flash fallback for "+n+" format"),u.html5[n]=!1,t[n]&&t[n].related))for(i=t[n].related.length-1;i>=0;i--)u.html5[t[n].related[i]]=!1};this._setSandboxType=function(n){var i=u.sandbox;i.type=n;i.description=i.types[i.types[n]!==t?n:"unknown"];i.type==="localWithFile"?(i.noRemote=!0,i.noLocal=!1,h("secNote",2)):i.type==="localWithNetwork"?(i.noRemote=!1,i.noLocal=!0):i.type==="localTrusted"&&(i.noRemote=!1,i.noLocal=!1)};this._externalInterfaceOK=function(n){if(u.swfLoaded)return!1;var t;if(tt("swf",!0),tt("flashtojs",!0),u.swfLoaded=!0,tr=!1,ru&&rf(),!n||n.replace(/\+dev/i,"")!==u.versionNumber.replace(/\+dev/i,""))return t=s+': Fatal: JavaScript file build "'+u.versionNumber+'" does not match Flash SWF build "'+n+'" at '+u.url+". Ensure both are up-to-date.",setTimeout(function(){throw new Error(t);},0),!1;setTimeout(ur,ct?100:1)};ai=function(n,i){function d(){var n=[],i,t=[],r=" + ";i="SoundManager "+u.version+(!u.html5Only&&u.useHTML5Audio?u.hasHTML5?" + HTML5 audio":", no HTML5 audio support":"");u.html5Only?u.html5PollingInterval&&n.push("html5PollingInterval ("+u.html5PollingInterval+"ms)"):(u.preferFlash&&n.push("preferFlash"),u.useHighPerformance&&n.push("useHighPerformance"),u.flashPollingInterval&&n.push("flashPollingInterval ("+u.flashPollingInterval+"ms)"),u.html5PollingInterval&&n.push("html5PollingInterval ("+u.html5PollingInterval+"ms)"),u.wmode&&n.push("wmode ("+u.wmode+")"),u.debugFlash&&n.push("debugFlash"),u.useFlashBlock&&n.push("flashBlock"));n.length&&(t=t.concat([n.join(r)]));u._wD(i+(t.length?r+t.join(", "):""),1);uf()}function s(n,t){return'<param name="'+n+'" value="'+t+'" />'}if(dt&&gt)return!1;if(u.html5Only)return hr(),d(),u.oMC=it(u.movieID),ur(),dt=!0,gt=!0,!1;var g=i||u.url,rt=u.altURL||g,y=li(),l=bt(),tt=null,p=e.getElementsByTagName("html")[0],r,h,a,b,o,f,v,k;if(tt=p&&p.dir&&p.dir.match(/rtl/i),n=n===t?u.id:n,hr(),u.url=pu(si?g:rt),i=u.url,u.wmode=!u.wmode&&u.useHighPerformance?"transparent":u.wmode,u.wmode!==null&&(w.match(/msie 8/i)||!ct&&!u.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(vt.push(ot.spcWmode),u.wmode=null),r={name:n,id:n,src:i,quality:"high",allowScriptAccess:u.allowScriptAccess,bgcolor:u.bgColor,pluginspage:hf+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:u.wmode,hasPriority:"true"},u.debugFlash&&(r.FlashVars="debug=1"),u.wmode||delete r.wmode,ct)h=e.createElement("div"),b=['<object id="'+n+'" data="'+i+'" type="'+r.type+'" title="'+r.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+hf+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',s("movie",i),s("AllowScriptAccess",u.allowScriptAccess),s("quality",r.quality),u.wmode?s("wmode",u.wmode):"",s("bgcolor",u.bgColor),s("hasPriority","true"),u.debugFlash?s("FlashVars",r.FlashVars):"","<\/object>"].join("");else{h=e.createElement("embed");for(a in r)r.hasOwnProperty(a)&&h.setAttribute(a,r[a])}if(vr(),l=bt(),y=li(),y)if(u.oMC=it(u.movieID)||e.createElement("div"),u.oMC.id)k=u.oMC.className,u.oMC.className=(k?k+" ":nt.swfDefault)+(l?" "+l:""),u.oMC.appendChild(h),ct&&(o=u.oMC.appendChild(e.createElement("div")),o.className=nt.swfBox,o.innerHTML=b),gt=!0;else{if(u.oMC.id=u.movieID,u.oMC.className=nt.swfDefault+" "+l,f=null,o=null,u.useFlashBlock||(u.useHighPerformance?f={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(f={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},tt&&(f.left=Math.abs(parseInt(f.left,10))+"px"))),yf&&(u.oMC.style.zIndex=1e4),!u.debugFlash)for(v in f)f.hasOwnProperty(v)&&(u.oMC.style[v]=f[v]);try{ct||u.oMC.appendChild(h);y.appendChild(u.oMC);ct&&(o=u.oMC.appendChild(e.createElement("div")),o.className=nt.swfBox,o.innerHTML=b);gt=!0}catch(ut){throw new Error(c("domError")+" \n"+ut.toString());}}return dt=!0,d(),!0};ci=function(){return u.html5Only?(ai(),!1):f?!1:u.url?(f=u.getMovie(u.id),f||(ii?(ct?u.oMC.innerHTML=pr:u.oMC.appendChild(ii),ii=null,dt=!0):ai(u.id,u.url),f=u.getMovie(u.id)),typeof u.oninitmovie=="function"&&setTimeout(u.oninitmovie,1),nu(),!0):(h("noURL"),!1)};pt=function(){setTimeout(cu,1e3)};sr=function(){n.setTimeout(function(){st(l+"useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false...");u.setup({preferFlash:!1}).reboot();u.didFlashBlock=!0;u.beginDelayedInit()},1)};cu=function(){var t,i=!1;if(!u.url||ri)return!1;if(ri=!0,p.remove(n,"load",pt),ft&&tr&&!uu)return h("waitFocus"),!1;v||(t=u.getMoviePercent(),t>0&&t<100&&(i=!0));setTimeout(function(){if(t=u.getMoviePercent(),i)return ri=!1,u._wD(c("waitSWF")),n.setTimeout(pt,1),!1;v||(u._wD(s+": No Flash response within expected time. Likely causes: "+(t===0?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(u.debugFlash?" "+c("checkSWF"):""),2),!si&&t&&(h("localFail",2),u.debugFlash||h("tryDebug",2)),t===0&&u._wD(c("swf404",u.url),1),tt("flashtojs",!1,": Timed out"+si?" (Check flash security or flash blockers)":" (No plugin/missing SWF?)"));!v&&of&&(t===null?u.useFlashBlock||u.flashLoadTimeout===0?(u.useFlashBlock&&wr(),h("waitForever")):!u.useFlashBlock&&fi?sr():(h("waitForever"),lt({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}})):u.flashLoadTimeout===0?h("waitForever"):!u.useFlashBlock&&fi?sr():yr(!0))},u.flashLoadTimeout)};cr=function(){function t(){p.remove(n,"focus",cr)}return uu||!tr?(t(),!0):(of=!0,uu=!0,h("gotFocus"),ri=!1,pt(),t(),!0)};nu=function(){vt.length&&(u._wD("SoundManager 2: "+vt.join(" "),1),vt=[])};uf=function(){nu();var n,t=[];if(u.useHTML5Audio&&u.hasHTML5){for(n in u.audioFormats)u.audioFormats.hasOwnProperty(n)&&t.push(n+" = "+u.html5[n]+(!u.html5[n]&&g&&u.flash[n]?" (using flash)":u.preferFlash&&u.flash[n]&&g?" (preferring flash)":u.html5[n]?"":" ("+(u.audioFormats[n].required?"required, ":"")+"and no flash support)"));u._wD("SoundManager 2 HTML5 support: "+t.join(", "),1)}};ni=function(t){if(v)return!1;if(u.html5Only)return h("sm2Loaded",1),v=!0,yt(),tt("onload",!0),!0;var f=u.useFlashBlock&&u.flashLoadTimeout&&!u.getMoviePercent(),r=!0,i;return f||(v=!0),i={type:!ft&&g?"NO_FLASH":"INIT_TIMEOUT"},u._wD("SoundManager 2 "+(d?"failed to load":"loaded")+" ("+(d?"Flash security/load error":"OK")+") "+String.fromCharCode(d?10006:10003),d?2:1),d||t?(u.useFlashBlock&&u.oMC&&(u.oMC.className=bt()+" "+(u.getMoviePercent()===null?nt.swfTimedout:nt.swfError)),lt({type:"ontimeout",error:i,ignoreInit:!0}),tt("onload",!1),wt(i),r=!1):tt("onload",!0),d||(u.waitForWindowLoad&&!hi?(h("waitOnload"),p.add(n,"load",yt)):(u.waitForWindowLoad&&hi&&h("docLoaded"),yt())),r};su=function(){var n,i=u.setupOptions;for(n in i)i.hasOwnProperty(n)&&(u[n]===t?u[n]=i[n]:u[n]!==i[n]&&(u.setupOptions[n]=u[n]))};ur=function(){function t(){p.remove(n,"load",u.beginDelayedInit)}if(v)return h("didInit"),!1;if(u.html5Only)return v||(t(),u.enabled=!0,ni()),!0;ci();try{f._externalInterfaceTest(!1);lu(!0,u.flashPollingInterval||(u.useHighPerformance?10:50));u.debugMode||f._disableDebug();u.enabled=!0;tt("jstoflash",!0);u.html5Only||p.add(n,"unload",rr)}catch(i){return u._wD("js/flash exception: "+i.toString()),tt("jstoflash",!1),wt({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),yr(!0),ni(),!1}return ni(),t(),!0};at=function(){return ti?!1:(ti=!0,su(),vr(),function(){var t="sm2-usehtml5audio=",i="sm2-preferflash=",r=null,f=null,n=kt.toLowerCase();n.indexOf(t)!==-1&&(r=n.charAt(n.indexOf(t)+t.length)==="1",oi&&console.log((r?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),u.setup({useHTML5Audio:r}));n.indexOf(i)!==-1&&(f=n.charAt(n.indexOf(i)+i.length)==="1",oi&&console.log((f?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),u.setup({preferFlash:f}))}(),!ft&&u.hasHTML5&&(u._wD("SoundManager 2: No Flash detected"+(u.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5."),1),u.setup({useHTML5Audio:!0,preferFlash:!1})),nf(),!ft&&g&&(vt.push(ot.needFlash),u.setup({flashLoadTimeout:1})),e.removeEventListener&&e.removeEventListener("DOMContentLoaded",at,!1),ci(),!0)};kr=function(){return e.readyState==="complete"&&(at(),e.detachEvent("onreadystatechange",kr)),!0};ar=function(){hi=!0;at();p.remove(n,"load",ar)};lr=function(){iu&&((!u.setupOptions.useHTML5Audio||u.setupOptions.preferFlash)&&vt.push(ot.mobileUA),u.setupOptions.useHTML5Audio=!0,u.setupOptions.preferFlash=!1,(gi||ef&&!w.match(/android\s2\.3/i))&&(vt.push(ot.globalHTML5),gi&&(u.ignoreFlash=!0),rt=!0))};lr();gr();p.add(n,"focus",cr);p.add(n,"load",pt);p.add(n,"load",ar);e.addEventListener?e.addEventListener("DOMContentLoaded",at,!1):e.attachEvent?e.attachEvent("onreadystatechange",kr):(tt("onload",!1),wt({type:"NO_DOM2_EVENTS",fatal:!0}))}if(!n||!n.document)throw new Error("SoundManager requires a browser with window and document objects.");var i=null;n.SM2_DEFER!==undefined&&SM2_DEFER||(i=new r);typeof module=="object"&&module&&typeof module.exports=="object"?(n.soundManager=i,module.exports.SoundManager=r,module.exports.soundManager=i):typeof define=="function"&&define.amd?define("SoundManager",[],function(){return{SoundManager:r,soundManager:i}}):(n.SoundManager=r,n.soundManager=i)})(window);var ngSoundManager=angular.module("angularSoundManager",[]).config(["$logProvider",function(n){n.debugEnabled(!1)}]);ngSoundManager.filter("humanTime",function(){return function(n){function t(n){return n<10?"0"+n.toString():n.toString()}var i=n/6e4<<0,r=Math.floor(n/1e3%60);return t(i)+":"+t(r)}});ngSoundManager.factory("angularPlayer",["$rootScope","$log",function(n,t){var s=null,c=!1,g=!0,o=!1,f=90,y=0,r=[],a=!1,l=!1,i=[],u=0,e=-1,p=null,v=null,h=null,w=null,b=null,k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)},d={init:function(){typeof soundManager=="undefined"&&alert("Please include SoundManager2 Library!");soundManager.setup({preferFlash:!1,debugMode:!1,useHTML5Audio:!0,onready:function(){},ontimeout:function(){alert("SM2 failed to start. Flash missing, blocked or security error?");alert("The status is "+status.success+", the error type is "+status.error.type)},defaultOptions:{autoLoad:!1,autoPlay:!1,from:null,loops:1,multiShot:!1,multiShotEvents:!1,onid3:null,onload:null,onstop:null,onfailure:"nextTrack",onpause:null,onplay:null,onresume:null,position:null,pan:0,stream:!0,to:null,type:"audio/mp3",usePolicyFile:!1,volume:f,whileloading:function(){var t=this.bytesLoaded/this.bytesTotal*100;n.$broadcast("track:loaded",t)},whileplaying:function(){s=this.id;y=this.position/this.duration*100;n.$broadcast("track:progress",y);n.$broadcast("currentTrack:position",this.position);n.$broadcast("currentTrack:duration",this.duration)},onfinish:function(){if(soundManager._writeDebug(this.id+" finished playing"),g===!0){var i=angular.element(document.querySelector("[ng-app]")),r=i.injector(),t=r.get("angularPlayer");l===!0?t.playTrack(this.id):t.nextTrack();n.$broadcast("track:id",s)}}}});soundManager.onready(function(){t.debug("song manager ready!");var i=soundManager.ok();t.debug("is supported: "+i);n.$broadcast("angularPlayer:ready",!0)})},isInArray:function(n,t){for(var i=0;i<n.length;i++)if(n[i].id===t)return i;return!1},getIndexByValue:function(n,t){for(var i=0;i<n.length;i++)if(n[i]===t)return i;return!1},asyncLoop:function(n){var t=-1,i=function(){if(t++,t==n.length){n.callback();return}n.functionToLoop(i,t)};i()},setCurrentTrack:function(n){s=n},getCurrentTrack:function(){return s},currentTrackData:function(){var n=this.getCurrentTrack(),t=this.isInArray(r,n);return r[t]},getPlaylist:function(n){return typeof n=="undefined"?r:r[n]},getTrack:function(n){for(var t=0;t<r.length;t++)if(r[t].id==n)return r[t];return null},addToPlaylist:function(t){r.push(t);n.$broadcast("player:playlist",r)},isTrackValid:function(n){if(typeof n=="undefined")return t.debug("invalid track data"),!1;if(n.url.indexOf("soundcloud")>-1){if(typeof n.url=="undefined")return t.debug("invalid soundcloud track url"),!1}else if(soundManager.canPlayURL(n.url)!==!0)return t.debug("invalid song url"),!1},addTrack:function(n){var t=this.isInArray(this.getPlaylist(),n.id);return t===!1&&(soundManager.createSound({id:n.id,url:n.url}),i.push(n.id),this.addToPlaylist(n)),n.id},addTrackArray:function(t){for(var u,e,f=0;f<t.length;f++)u=t[f],e=this.isInArray(this.getPlaylist(),u.id),e===!1&&(soundManager.createSound({id:u.id,url:u.url}),i.push(u.id),r.push(u));n.$broadcast("player:playlist",r)},removeSong:function(t,f){t===s&&this.stop();soundManager.destroySound(t);r.splice(f,1);var o=this.getIndexByValue(i,t);i.splice(o,1);o<=e&&e--;o<=u-1&&u--;n.$broadcast("player:playlist",r)},initPlayTrack:function(t,i,r){if(i!==!0&&(this.stop(),this.setCurrentTrack(t)),p!=null&&i!==!0){var e=this,u=soundManager.getSoundById(t);u.setVolume(f);p(u,this.currentTrackData(),function(){soundManager.play(t);n.$broadcast("track:id",t);o=!0;n.$broadcast("music:isPlaying",o);r==!0&&e.pause()})}else soundManager.play(t),n.$broadcast("track:id",t),o=!0,n.$broadcast("music:isPlaying",o)},play:function(){var n=null;if(this.getCurrentTrack()===null){if(soundManager.soundIDs.length===0){t.debug("playlist is empty!");return}n=soundManager.soundIDs[0];this.initPlayTrack(n)}else n=this.getCurrentTrack(),this.initPlayTrack(n,!0)},pause:function(){soundManager.pause(this.getCurrentTrack());o=!1;n.$broadcast("music:isPlaying",o)},stop:function(){this.pause();this.resetProgress();n.$broadcast("track:progress",y);n.$broadcast("currentTrack:position",0);n.$broadcast("currentTrack:duration",0);soundManager.stopAll();soundManager.unload(this.getCurrentTrack())},loadTrack:function(n){this.initPlayTrack(n,!1,!0)},playTrack:function(n){this.initPlayTrack(n)},nextTrack:function(){var r,f;if(a){if(u==0&&(i.length==0&&(i=soundManager.soundIDs.slice()),r=this.getIndexByValue(i,this.getCurrentTrack()),f=i[r],i[r]=i[u],i[u]=f,e++,u++),e+1<u){e++;this.initPlayTrack(i[e]);return}if(u==i.length){t.debug("Shuffle list played finish, no next");return}r=u+Math.floor(Math.random()*(i.length-u));f=i[r];i[r]=i[u];i[u]=f;e++;this.initPlayTrack(i[e]);u++;return}if(this.getCurrentTrack()===null)return t.debug("Please click on Play before this action"),null;var h=this.getIndexByValue(soundManager.soundIDs,this.getCurrentTrack()),l=+h+1,s=soundManager.soundIDs[l];typeof s!="undefined"?this.playTrack(s):c===!0?this.playTrack(soundManager.soundIDs[0]):(o=!1,n.$broadcast("music:isPlaying",o))},prevTrack:function(){if(a){if(e<=0)return;e--;this.initPlayTrack(i[e]);return}if(this.getCurrentTrack()===null)return t.debug("Please click on Play before this action"),null;var r=this.getIndexByValue(soundManager.soundIDs,this.getCurrentTrack()),u=+r-1,n=soundManager.soundIDs[u];typeof n!="undefined"?this.playTrack(n):t.debug("no prev track found!")},mute:function(){soundManager.muted===!0?soundManager.unmute():soundManager.mute();n.$broadcast("music:mute",soundManager.muted)},getMuteStatus:function(){return soundManager.muted},repeatToggle:function(){c=c===!0?!1:!0;n.$broadcast("music:repeat",c)},getRepeatStatus:function(){return c},repeatOneToggle:function(){l=l===!0?!1:!0},getRepeatOneStatus:function(){return l},setRepeatOneStatus:function(n){l=n},getVolume:function(){return f},adjustVolume:function(t){var i=function(t){for(var r,i=0;i<soundManager.soundIDs.length;i++)r=soundManager.getSoundById(soundManager.soundIDs[i]),r.setVolume(t);n.$broadcast("music:volume",t)};t===!0?f<100&&(f=f+10,i(f)):f>0&&(f=f-10,i(f))},adjustVolumeSlider:function(t){var i=function(t){for(var r,i=0;i<soundManager.soundIDs.length;i++)r=soundManager.getSoundById(soundManager.soundIDs[i]),r.setVolume(t);n.$broadcast("music:volume",t)};f=t;i(t)},clearPlaylist:function(i){t.debug("clear playlist");this.resetProgress();this.clearShuffle();var u=soundManager.soundIDs.length;this.asyncLoop({length:u,functionToLoop:function(n){setTimeout(function(){soundManager.destroySound(soundManager.soundIDs[0]);n()},0)},callback:function(){t.debug("All done!");r=[];n.$broadcast("player:playlist",r);i(!0)}})},resetProgress:function(){y=0},isPlayingStatus:function(){return o},clearShuffle:function(){i=[];u=0;e=-1},getShuffle:function(){return a},toggleShuffle:function(){a=!a;this.clearShuffle()},setBootstrapTrack:function(n){p=n},setShowFrequency:function(n){b=n},drawFrequency:function(){var t,r,i,u;o&&b&&s&&(t=soundManager.sounds[s]._a,w!=t&&(v=new(window.AudioContext||window.webkitAudioContext),v&&(h=v.createAnalyser(),r=v.createMediaElementSource(t),r.connect(h),h.connect(v.destination),h.fftSize=256),w=t),i=new Uint8Array(0),h&&(u=h.frequencyBinCount,i=new Uint8Array(u),h.getByteFrequencyData(i)),n.$broadcast("currentTrack:Frequency",i));k(d.drawFrequency)},requestAnimationFrame:function(n){k(n)}};return d}]);ngSoundManager.directive("soundManager",["$filter","$timeout","angularPlayer",function(n,t,i){return{restrict:"E",link:function(r){i.init();r.$on("track:progress",function(n,i){t(function(){r.progress=i})});r.$on("track:id",function(){t(function(){r.currentPlaying=i.currentTrackData()})});r.$on("currentTrack:position",function(i,u){t(function(){r.currentPosition=n("humanTime")(u)})});r.$on("currentTrack:duration",function(i,u){t(function(){r.currentDuration=n("humanTime")(u)})});r.isPlaying=!1;r.$on("music:isPlaying",function(n,i){t(function(){r.isPlaying=i})});r.playlist=i.getPlaylist();r.$on("player:playlist",function(n,i){t(function(){r.playlist=i})})}}}]);ngSoundManager.directive("musicPlayer",["angularPlayer","$log",function(n,t){return{restrict:"EA",scope:{song:"=addSong"},link:function(i,r,u){var f=function(){var t=n.addTrack(i.song);u.musicPlayer==="play"&&n.playTrack(t)};r.bind("click",function(){t.debug("adding song to playlist");f()})}}}]);ngSoundManager.directive("playFromPlaylist",["angularPlayer",function(n){return{restrict:"EA",scope:{song:"=playFromPlaylist"},link:function(t,i){i.bind("click",function(){n.playTrack(t.song.id)})}}}]);ngSoundManager.directive("removeFromPlaylist",["angularPlayer",function(n){return{restrict:"EA",scope:{song:"=removeFromPlaylist"},link:function(t,i,r){i.bind("click",function(){n.removeSong(t.song.id,r.index)})}}}]);ngSoundManager.directive("seekTrack",["angularPlayer","$log",function(n,t){return{restrict:"EA",link:function(i,r){r.bind("click",function(i){if(n.getCurrentTrack()===null){t.debug("no track loaded");return}var u=soundManager.getSoundById(n.getCurrentTrack()),f=function(n){for(var i=0,t=n.target;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-t.scrollLeft,t=t.offsetParent;return n.clientX-i},e=i.offsetX||f(i),o=r[0].clientWidth,s=u.durationEstimate;u.setPosition(e/o*s)})}}}]);ngSoundManager.directive("playMusic",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.play()})}}}]);ngSoundManager.directive("pauseMusic",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.pause()})}}}]);ngSoundManager.directive("stopMusic",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.stop()})}}}]);ngSoundManager.directive("nextTrack",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.nextTrack()})}}}]);ngSoundManager.directive("prevTrack",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.prevTrack()})}}}]);ngSoundManager.directive("muteMusic",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.mute()});t.mute=n.getMuteStatus();t.$on("music:mute",function(n,i){t.$apply(function(){t.mute=i})})}}}]);ngSoundManager.directive("repeatMusic",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(){n.repeatToggle()});t.repeat=n.getRepeatStatus();t.$on("music:repeat",function(n,i){t.$apply(function(){t.repeat=i})})}}}]);ngSoundManager.directive("musicVolume",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i,r){i.bind("click",function(){r.type==="increase"?n.adjustVolume(!0):n.adjustVolume(!1)});t.volume=n.getVolume();t.$on("music:volume",function(n,i){t.$apply(function(){t.volume=i})})}}}]);ngSoundManager.directive("clearPlaylist",["angularPlayer","$log","$rootScope",function(n,t,i){return{restrict:"EA",link:function(r,u){u.bind("click",function(){n.stop();n.setCurrentTrack(null);i.$broadcast("track:id",null);n.clearPlaylist(function(){t.debug("all clear!")})})}}}]);ngSoundManager.directive("playAll",["angularPlayer","$log",function(n,t){return{restrict:"EA",scope:{songs:"=playAll"},link:function(i,r,u){r.bind("click",function(){n.clearPlaylist(function(){t.debug("cleared, ok now add to playlist");for(var r=0;r<i.songs.length;r++)n.addTrack(i.songs[r]);u.play!="false"&&n.play()})})}}}]);ngSoundManager.directive("volumeBar",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i){i.bind("click",function(t){var r=function(n){for(var i=0,t=n.target;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)i+=t.offsetLeft-t.scrollLeft,t=t.offsetParent;return n.clientX-i},u=t.offsetX||r(t),f=i[0].clientWidth,e=u/f*100;n.adjustVolumeSlider(e)});t.volume=n.getVolume();t.$on("music:volume",function(n,i){t.$apply(function(){t.volume=i})})}}}]);ngSoundManager.directive("playPauseToggle",["angularPlayer",function(n){return{restrict:"EA",link:function(t,i,r){t.$on("music:isPlaying",function(n,t){t?typeof r.pause!="undefined"?i.html(r.pause):i.html("Pause"):typeof r.play!="undefined"?i.html(r.play):i.html("Play")});i.bind("click",function(){n.isPlayingStatus()?n.pause():n.play()})}}}]);